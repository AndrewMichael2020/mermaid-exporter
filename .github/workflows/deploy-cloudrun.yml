name: Build and Deploy to Cloud Run (caller)

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  call-reusable-deploy:
    uses: ./.github/workflows/reusable-deploy-cloudrun.yml
    with:
      project: ${{ secrets.GCP_PROJECT }}
      service: ${{ secrets.CLOUD_RUN_SERVICE }}
      region: ${{ secrets.CLOUD_RUN_REGION }}
      default-region: us-central1
      image-tag: ${GITHUB_SHA}
      secrets-to-check: |
        NEXT_PUBLIC_FIREBASE_API_KEY
        NEXT_PUBLIC_FIREBASE_PROJECT_ID
        NEXT_PUBLIC_FIREBASE_APP_ID
        NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
        NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
        NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        GEMINI_API_KEY
    secrets:
      GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
